# 作业管理系统修改计划

## 需求概述

根据用户需求，对现有作业管理系统进行以下修改：

---

## 一、作业生命周期管理

### 1.1 作业归档机制
**现状**：所有作业都显示在"已发布"列表中
**修改**：
- 过了截止日期的作业自动移到"归档"区域
- "已发布"只显示未过期的作业
- 管理员页面分两个区域显示：已发布 / 归档

**涉及文件**：
- `app/admin/page.tsx` - 添加归档区域 UI
- `app/api/admin/overview/route.ts` - 可能需要添加归档标识

### 1.2 过期作业禁止提交
**现状**：学生可以提交任何作业
**修改**：
- 学生端：过期作业显示"已截止"状态，禁用提交按钮
- 后端：API 校验截止日期，拒绝过期提交
- 历史页面：显示逾期未完成的作业

**涉及文件**：
- `app/submit/page.tsx` - 添加截止判断和 UI 提示
- `app/api/submit/route.ts` - 添加后端校验
- `app/page.tsx` - 首页显示逾期状态

### 1.3 作业操作增强
**现状**：作业只能编辑
**修改**：
- 添加"删除"功能
- 添加"立即截止"功能（不论时间到没到）
- 支持修改所有字段

**涉及文件**：
- `app/admin/page.tsx` - 添加删除、截止按钮
- `app/api/admin/assignment/route.ts` - 添加 DELETE 方法，添加截止逻辑

---

## 二、导出功能重构

### 2.1 导出格式改为 Word
**现状**：导出 CSV 文件
**修改**：
- 改为导出 Word 文档（.docx）
- 使用 `docx` npm 包生成 Word 文件

**涉及文件**：
- `app/api/admin/export/route.ts` - 完全重写
- `package.json` - 添加 `docx` 依赖

### 2.2 导出字段调整
**现状**：导出所有字段
**修改**：
- 只导出：时间、姓名、科目、是否提交、日期

### 2.3 灵活日期选择
**现状**：只能导出当天
**修改**：
- 支持选择单天导出
- 支持选择日期范围导出（多天一起）
- 管理页面添加日期选择器

**涉及文件**：
- `app/admin/page.tsx` - 添加日期选择 UI
- `app/api/admin/export/route.ts` - 支持日期参数

---

## 三、管理页面图形化统计

### 3.1 添加统计图表
**修改**：
- 添加提交情况统计图（饼图/柱状图）
- 显示：已提交人数、未提交人数、逾期人数
- 按科目分类统计
- 按日期趋势统计

**涉及文件**：
- `app/admin/page.tsx` - 添加统计区域
- 可能需要添加图表库（如 Chart.js 或 Recharts）
- `package.json` - 添加图表依赖

---

## 四、时间显示优化

### 4.1 人性化时间格式
**现状**：显示程序式时间（ISO 格式或类似）
**修改**：
- 改为人性化显示：
  - "今天 14:30"
  - "昨天 18:00"
  - "3天前"
  - "2024年12月31日 23:59"

**涉及文件**：
- `app/lib/format.ts` - 添加人性化时间函数
- 所有显示时间的页面组件

---

## 五、学生端作业状态

### 5.1 每日作业完成情况
**修改**：
- 首页显示今日作业状态：
  - ✅ 已完成的作业
  - ⏳ 未完成的作业
  - ❌ 已逾期的作业
- 清晰的状态标识

**涉及文件**：
- `app/page.tsx` - 添加作业状态区域
- `app/components/me-context.tsx` - 可能需要计算状态

### 5.2 逾期作业处理
**修改**：
- 逾期作业不能提交
- 显示"已逾期，无法提交"提示
- 历史页面标注逾期状态

**涉及文件**：
- `app/submit/page.tsx` - 禁用逾期作业
- `app/history/page.tsx` - 显示逾期标识

---

## 六、布置作业优化

### 6.1 标题可为空
**现状**：标题显示为"科目 · 标题"
**修改**：
- 标题为空时，只显示科目名称
- 删除前面的点（·）

**涉及文件**：
- `app/admin/page.tsx` - 标题输入可选
- `app/submit/page.tsx` - 显示逻辑调整
- 其他显示作业标题的地方

### 6.2 截止日期默认明天
**现状**：截止日期需要手动选择
**修改**：
- 新建作业时，截止日期默认填入"明天"

**涉及文件**：
- `app/admin/page.tsx` - 设置默认值

---

## 七、错别字修正

### 7.1 "流言" → "留言"
**现状**：代码和 UI 中使用"流言"
**修改**：
- 全局替换为"留言"

**涉及文件**：
- `app/submit/page.tsx`
- `app/history/page.tsx`
- `app/admin/page.tsx`
- 其他涉及的文件

---

## 实施顺序

### 第一阶段：基础修改
1. 修复"流言"错别字
2. 标题可为空的显示逻辑
3. 截止日期默认明天
4. 人性化时间显示

### 第二阶段：作业生命周期
5. 作业归档机制
6. 过期作业禁止提交
7. 作业删除、立即截止功能

### 第三阶段：学生端增强
8. 每日作业完成状态显示
9. 逾期作业状态处理

### 第四阶段：导出功能重构
10. 安装 docx 依赖
11. 重写导出 API
12. 添加日期选择 UI

### 第五阶段：图形化统计
13. 安装图表库
14. 添加统计图表 UI

---

## 需要安装的依赖

```bash
npm install docx        # Word 文档生成
npm install recharts    # 图表库（React 友好）
```

---

## 注意事项

1. 所有修改需要保持与现有 Telegram 存储兼容
2. 时间计算需要考虑时区（Asia/Shanghai）
3. 前后端都需要做截止日期校验
4. 图表需要考虑移动端适配
